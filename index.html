<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gruvbox Visual Novel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
body {
  font-size: 30px;
}
.text-xs { font-size: 1.2rem !important; }
.text-sm { font-size: 1.4rem !important; }
.text-base { font-size: 1.7rem !important; }
.text-lg { font-size: 2rem !important; }
.text-xl { font-size: 2.3rem !important; }

@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.bounce-hover:hover { animation: bounce 0.5s ease; }
.fade-in { animation: fadeIn 0.5s ease-in-out; }

.typing { border-right: 2px solid #eb6f92; animation: blink 0.75s step-end infinite; }
@keyframes blink { from, to { border-color: transparent } 50% { border-color: #eb6f92 } }

.custom-scrollbar::-webkit-scrollbar { width: 6px; }
.custom-scrollbar::-webkit-scrollbar-track { background: #3c3836; }
.custom-scrollbar::-webkit-scrollbar-thumb { background: #bdae93; border-radius: 3px; }
.custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #f6c177; }

.pixel-box { position: relative; box-shadow: 4px 4px 0px rgba(0,0,0,0.2); }
.pixel-box:before {
    content: "";
    position: absolute;
    top: -8px; left: -8px; right: -8px; bottom: -8px;
    border: 1px solid #eb6f92;
    pointer-events: none;
    z-index: -1;
}
.pixel-avatar {
    image-rendering: pixelated;
    border: 4px solid #191724 !important;
}
#next-btn { border: none; }
    </style>
</head>
<body class="bg-[#1f1d2e] text-[#e0def4] font-['VT323'] min-h-screen flex flex-col" style="font-size: 20px;">
    <div id="scene-container" class="fixed inset-0 z-0 opacity-0 transition-opacity duration-500 pointer-events-none">
        <div id="scene" class="absolute inset-0 bg-cover bg-center"></div>
        <div class="absolute inset-0 bg-black/40"></div>
    </div>

    <main class="relative z-10 flex-1 flex flex-col max-w-4xl mx-auto w-full px-4 py-8">
        <div id="dialogue-history" class="custom-scrollbar flex-1 overflow-y-auto mb-4 space-y-6 pr-2"></div>

        <div id="current-dialogue" class="bg-[#26233a] border-4 border-[#191724] fade-in pixel-box"></div>

        <div class="mt-6 flex justify-end">
            <button id="next-btn" class="bg-[#eb6f92] hover:bg-[#f6c177] text-[#191724] font-['Press+Start+2P'] py-3 px-8 border-4 transition-all hover:border-[#f6c177] text-sm">next</button>
            <button id="reset-btn" class="ml-4 bg-[#f6c177] hover:bg-[#eb6f92] text-[#191724] font-['Press+Start+2P'] py-3 px-6  text-sm">reset</button>
        </div>
    </main>

    <script>
        const story = [
            {
                scene: "./img/scen/w.jpg",
                character: "Lena",
                avatar: "./img/frenda.png",
                text: "Lorem"
            },
            {
                character: "Lena",
                avatar: "./img/frenda.png",
                text: "I never thought it would come to this. One wrong decision, and now everything's falling apart."
            },
            {
                character: "Kai",
                avatar: "https://i.pravatar.cc/150?img=11",
                text: "Lena? What are you doing up here? It's freezing!"
            },
            {
                scene: "./img/scen/w.g",
                character: "Lena",
                avatar: "./img/frenda.png",
                text: "Kai... I didn't hear you coming. I just needed some air."
            },
            {
                character: "Kai",
                avatar: "https://i.pravatar.cc/150?img=11",
                text: "At midnight? On the rooftop? Come on, I know you better than that. What's really going on?"
            },
            {
                scene: "https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                character: "Lena",
                avatar: "./img/frenda.png",
                text: "*sigh* It's the project... I messed up big time. The client found out about the security flaw, and now they're threatening legal action."
            },
            {
                character: "Kai",
                avatar: "https://i.pravatar.cc/150?img=11",
                text: "Wait, what? Why didn't you tell me? We could have fixed this together!"
            },
            {
                character: "Lena",
                avatar: "./img/frenda.png",
                text: "I was scared, okay? I thought I could handle it alone. But now... I don't know what to do."
            }
        ];

        let currentIndex = parseInt(localStorage.getItem('vn_progress')) || 0;
        const dialogueHistory = document.getElementById('dialogue-history');
        const currentDialogue = document.getElementById('current-dialogue');
        const nextBtn = document.getElementById('next-btn');
        const sceneContainer = document.getElementById('scene-container');
        const sceneElement = document.getElementById('scene');

        function showDialogue(index) {
            const entry = story[index];

            if (index > 0) {
                const prevEntry = story[index - 1];
                const historyEntry = document.createElement('div');
                historyEntry.className = 'flex space-x-4 items-start fade-in';
                historyEntry.innerHTML = `
                    <div class="flex-shrink-0">
                        <img src="${prevEntry.avatar}" alt="${prevEntry.character}" class="w-14 h-14 pixel-avatar object-cover">
                    </div>
                    <div class="flex-1">
                        <div class="font-['Press+Start+2P'] text-[#eb6f92]">${prevEntry.character}</div>
                        <div class="mt-1 text-[#e0def4] text-sm">${prevEntry.text}</div>
                    </div>
                `;
                dialogueHistory.appendChild(historyEntry);
                dialogueHistory.scrollTop = dialogueHistory.scrollHeight;
            }

            currentDialogue.innerHTML = `
                <div class="flex space-x-4 p-4">
                    <div class="flex-shrink-0">
                        <img src="${entry.avatar}" alt="${entry.character}" class="w-16 h-16 pixel-avatar object-cover">
                    </div>
                    <div class="flex-1">
                        <div class="font-['Press+Start+2P'] text-sm text-[#eb6f92] mb-1">${entry.character}</div>
                        <div id="typing-text" class="text-[#e0def4] leading-snug"></div>
                    </div>
                </div>
            `;

            const textElement = document.getElementById('typing-text');
            const fullText = entry.text;
            let charIndex = 0;

            function typeWriter() {
                if (charIndex < fullText.length) {
                    textElement.textContent = fullText.substring(0, charIndex + 1);
                    textElement.classList.add('typing');
                    charIndex++;
                    setTimeout(typeWriter, 20);
                } else {
                    textElement.classList.remove('typing');
                }
            }

            typeWriter();

            if (entry.scene) {
                sceneElement.style.backgroundImage = `url('${entry.scene}')`;
                sceneContainer.classList.remove('opacity-0');
                sceneContainer.classList.add('opacity-100');
            } else if (index > 0 && story[index - 1].scene && !entry.scene) {
                sceneContainer.classList.remove('opacity-100');
                sceneContainer.classList.add('opacity-0');
            }
        }

        showDialogue(currentIndex);

        nextBtn.addEventListener('click', () => {
            currentIndex++;
            localStorage.setItem('vn_progress', currentIndex);
            if (currentIndex < story.length) {
                showDialogue(currentIndex);
            } else {
                currentDialogue.innerHTML = `
                    <div class="p-8 text-center">
                        <div class="text-2xl text-[#d79921] mb-4">The End</div>
                        <div class="text-[#ebdbb2]">Thank you for experiencing this story.</div>
                    </div>
                `;
                nextBtn.disabled = true;
                nextBtn.classList.remove('hover:scale-105', 'hover:bg-[#b8bb26]');
                nextBtn.classList.add('opacity-50');
            }
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            localStorage.removeItem('vn_progress');
            location.reload();
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('#dialogue-history') && e.target.id !== 'next-btn') {
                nextBtn.click();
            }
        });
    </script>
</body>
</html>
